<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DealScoutPro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="header-container">
            <h1>DealScoutPro</h1>
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Cerca offerte...">
                    <button id="searchButton"><i class="fas fa-search"></i></button>
                </div>
                <div class="filter-box">
                    <button id="filterButton"><i class="fas fa-filter"></i></button>
                    <div id="filterDropdown" class="dropdown-content">
                        <a href="#" class="filter-option active" data-filter="all">Tutti</a>
                        <a href="#" class="filter-option" data-filter="discount-50">Sconto > 50%</a>
                        <a href="#" class="filter-option" data-filter="discount-30">Sconto > 30%</a>
                        <a href="#" class="filter-option" data-filter="discount-20">Sconto > 20%</a>
                        <a href="#" class="filter-option" data-filter="discount-10">Sconto > 10%</a>
                    </div>
                </div>
                <div class="sort-box">
                    <button id="sortButton"><i class="fas fa-sort-amount-down-alt"></i></button>
                    <div id="sortDropdown" class="dropdown-content">
                        <a href="#" class="sort-option active" data-sort-by="price" data-sort-order="asc">Prezzo crescente</a>
                        <a href="#" class="sort-option" data-sort-by="price" data-sort-order="desc">Prezzo decrescente</a>
                        <a href="#" class="sort-option" data-sort-by="discount" data-sort-order="desc">Sconto maggiore</a>
                        <a href="#" class="sort-option" data-sort-by="discount" data-sort-order="asc">Sconto minore</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="offers-grid" id="offersGrid">
                </section>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const offersGrid = document.getElementById('offersGrid');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const filterButton = document.getElementById('filterButton');
            const filterDropdown = document.getElementById('filterDropdown');
            const filterOptions = document.querySelectorAll('.filter-option');
            const sortButton = document.getElementById('sortButton');
            const sortDropdown = document.getElementById('sortDropdown');
            const sortOptions = document.querySelectorAll('.sort-option');
            let allOffers = [];
            let currentFilteredOffers = [];

            const getDiscountColorClass = (discount) => {
                if (discount >= 50) {
                    return 'red-discount';
                } else if (discount >= 30) {
                    return 'green-discount';
                } else if (discount >= 20) {
                    return 'blue-discount';
                } else if (discount >= 10) {
                    return 'orange-discount';
                } else if (discount > 0) {
                    return 'grey-discount';
                } else {
                    return '';
                }
            };
        
            const fetchOffers = async () => {
                try {
                    const response = await fetch('data.json');
                    allOffers = await response.json();
                    currentFilteredOffers = [...allOffers];
                    displayOffers(currentFilteredOffers);
                } catch (error) {
                    console.error('Errore nel caricamento delle offerte:', error);
                    offersGrid.innerHTML = '<p>Errore nel caricamento delle offerte.</p>';
                }
            };
        
            const createOfferCard = (offer) => {
                const oldPrice = (offer.price / (1 - (offer.discount / 100))).toFixed(2);
                const discountColorClass = getDiscountColorClass(offer.discount);
                
                const card = document.createElement('article');
                card.classList.add('offer-card');
                card.innerHTML = `
                    <div class="card-image-container">
                        <img src="${offer.image}" alt="${offer.title}">
                        <span class="discount-badge ${discountColorClass}">${offer.discount}%</span>
                    </div>
                    <div class="card-content-wrapper">
                        <div class="card-content">
                            <h4>${offer.title}</h4>
                        </div>
                        <div class="bottom-row">
                            <div class="price-container">
                                <span class="current-price">€${offer.price.toFixed(2)}</span>
                                <span class="old-price">€${oldPrice}</span>
                            </div>
                            <a href="${offer.link}" class="cta-button"></a>
                        </div>
                    </div>
                `;
                return card;
            };
        
            const displayOffers = (offers) => {
                offersGrid.innerHTML = '';
                if (offers.length === 0) {
                    offersGrid.innerHTML = '<p>Nessuna offerta trovata.</p>';
                    return;
                }
                offers.forEach(offer => {
                    offersGrid.appendChild(createOfferCard(offer));
                });
            };

            const filterAndSortOffers = () => {
                const searchTerm = searchInput.value;
                const activeFilter = document.querySelector('.filter-option.active');
                const filterType = activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
                
                const sortBy = document.querySelector('.sort-option.active').getAttribute('data-sort-by');
                const sortOrder = document.querySelector('.sort-option.active').getAttribute('data-sort-order');

                let filtered = allOffers.filter(offer => {
                    const matchesSearch = offer.title.toLowerCase().includes(searchTerm.toLowerCase());

                    if (filterType === 'all') {
                        return matchesSearch;
                    } else if (filterType === 'discount-50') {
                        return matchesSearch && offer.discount >= 50;
                    } else if (filterType === 'discount-30') {
                        return matchesSearch && offer.discount >= 30;
                    } else if (filterType === 'discount-20') {
                        return matchesSearch && offer.discount >= 20;
                    } else if (filterType === 'discount-10') {
                        return matchesSearch && offer.discount >= 10;
                    }
                    return matchesSearch;
                });
                
                filtered.sort((a, b) => {
                    let valA, valB;
                    if (sortBy === 'price') {
                        valA = a.price;
                        valB = b.price;
                    } else if (sortBy === 'discount') {
                        valA = a.discount;
                        valB = b.discount;
                    }

                    if (sortOrder === 'asc') {
                        return valA - valB;
                    } else {
                        return valB - valA;
                    }
                });

                currentFilteredOffers = filtered;
                displayOffers(currentFilteredOffers);
            };
        
            // Gestione dei menu a tendina
            const toggleDropdown = (button, dropdown) => {
                const isVisible = dropdown.classList.contains('show');
                
                document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));

                if (!isVisible) {
                    dropdown.classList.add('show');
                }
            };

            filterButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown(filterButton, filterDropdown);
            });
            
            sortButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown(sortButton, sortDropdown);
            });
        
            window.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));
            });
        
            filterOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    filterOptions.forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    filterAndSortOffers();
                });
            });
        
            sortOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    sortOptions.forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const sortBy = e.target.getAttribute('data-sort-by');
                    const sortOrder = e.target.getAttribute('data-sort-order');
                    
                    const icon = sortButton.querySelector('i');
                    if (sortBy === 'price') {
                        icon.className = sortOrder === 'asc' ? 'fas fa-sort-amount-down-alt' : 'fas fa-sort-amount-up-alt';
                    } else if (sortBy === 'discount') {
                        icon.className = sortOrder === 'asc' ? 'fas fa-percentage' : 'fas fa-percentage fa-rotate-180';
                    }

                    filterAndSortOffers();
                });
            });
        
            // Gestione della ricerca
            searchButton.addEventListener('click', filterAndSortOffers);
        
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    filterAndSortOffers();
                }
            });

            fetchOffers();
        });
    </script>
</body>
</html>
